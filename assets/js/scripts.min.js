function isEmpty(e){if(null==e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;if("object"!=typeof e)return!0;for(var a in e)if(hasOwnProperty.call(e,a))return!1;return!0}function createRoute(e,a,r){var t=leaflet_vars.markerUrl,o=(L.icon({iconUrl:t,iconSize:[14,14],shadowSize:[0,0],iconAnchor:[7,7],shadowAnchor:[4,62],popupAnchor:[0,0]}),L.featureGroup({snakingPause:500}));if(e.length>0&&a.length>0){for(i=0;i<a.length;i++){var n=L.marker(e[i],{icon:new L.DivIcon({className:"map__marker",html:'<img class="map__marker__image" src="'+t+'"><span class="map__marker__label">'+r[i]+"</span>"})}),s=L.polyline(a[i],{color:leaflet_vars.yellowTandem,className:"map__line",weight:6,opacity:.9,dashArray:"12, 10",lineJoin:"round",snakingSpeed:200});o.addLayer(n).addLayer(s)}if(1==a.length){var l=L.marker(e[i],{icon:new L.DivIcon({className:"map__marker",html:'<img class="map__marker__image" src="'+t+'"><span class="map__marker__label">'+r[i]+"</span>"})});l.bindPopup(r[i]),o.addLayer(l)}}return o}function getQueryTag(e,a){var r=document.createElement("a"),t=document.createElement("li"),i=document.createTextNode(e.name);return r.setAttribute("data-term_id",e.id),r.setAttribute("data-slug",e.slug),r.setAttribute("data-tax",e.tax),r.setAttribute("title",e.name),r.setAttribute("href","#"),r.addEventListener("click",function(e){e.preventDefault(),a.removeAttr("selected"),this.parentNode.remove(),fetchCollaborations()}),r.className="tag query-tag "+e.tax,r.appendChild(i),t.appendChild(r),t}function getRandomProgrammeRound(){var e=jQuery(".archive__filter").find(".archive__filter__tax-datalist[data-tax=post_tag]").find("option");if(e.length){var a=e.length,r=Math.floor(Math.random()*a);return console.log(r),prog=jQuery(e[r]),prog.data("slug")}}jQuery(document).foundation();var hasOwnProperty=Object.prototype.hasOwnProperty,baseUrl=location.origin,mapInitial=1,map,routeLayer;location.origin||(baseUrl=location.protocol+"//"+location.host),"http://localhost"==location.origin&&(baseUrl=location.origin+"/tandem");var getFocusTranslate=function(e,a){if(img_data=e.parentNode.dataset,!img_data)return!1;var r=a.offsetHeight,t=e.offsetHeight,i=img_data.focus_h*r-t/2,o=(r-t)/r*100,n=i/r*100;return!(i<0||n<0)&&(n>o?o:n)},doFocusTranslate=function(e){var a=e.parentNode;if(translate=getFocusTranslate(a,e),translate){var r=translate>0?-1*translate:translate,t="transform: translateY("+r+"%);";e.setAttribute("style",t)}};jQuery(document).foundation(),jQuery(document).ready(function(){function e(){var e=jQuery(".archive__filter__query-tags").find("a.tag"),a={object:"collaborations",taxquery:{}};if(e.length)for(var r=0;r<e.length;r++){var t=jQuery(e[r]),i=t.data("tax"),o=t.data("slug");("string"==typeof i||i instanceof String)&&("string"==typeof o||o instanceof String)&&(a.taxquery[i]=o)}else if(1==mapInitial){var n=getRandomProgrammeRound();a.taxquery={tag:n},mapInitial=0}var s="",l=a.taxquery;if(isEmpty(l))return null;for(var c in a.taxquery)l.hasOwnProperty(c)&&(s+="&filter["+c+"]="+l[c]);var u="?filter[post_status]=publish"+s+"&filter[orderby]=date&filter[order]=desc",h="/wp-json/wp/v2/"+a.object,p=baseUrl+h+u;return p}function a(){var a=e();null===a?(console.log("emptying map"),map.removeLayer(routeLayer)):(console.log("called with "+a),jQuery.when(jQuery.ajax({url:a,method:"GET",crossDomain:!0,contentType:"application/json"})).then(function(e,a,t){var i=e.length,o=[];if(i>0){for(var n=0;n<i;n++)o.push(e[n].exchange_basics.data);collectionLength=o.length,routes=[];for(var s=0;s<collectionLength;s++){var l=r(o[s]);null!==l&&routes.push(l)}console.log(routes),void 0!==routeLayer&&map.removeLayer(routeLayer),routes.length>0&&(routeLayer=L.layerGroup(routes).addTo(map))}}))}function r(e){console.log(e);var a=[],r=[],i=[],o=[],n={name:e.title,link:e.link};if(isEmpty(e.locations))return null;for(var s in e.locations)if(e.locations.hasOwnProperty(s)){var l=e.locations[s],c=[];jQuery.isNumeric(l.org_lat)&&c.push(l.org_lat),jQuery.isNumeric(l.org_lng)&&c.push(l.org_lng),2==c.length&&a.push(c),""!=l.org_city&&i.push(l.org_city)}for(var u=a.length,h=0;h<u;h++)r.push(a[h]),h===u-1?u>2&&o.push([a[h],a[0]]):o.push([a[h],a[h+1]]);2==u&&r.push(a[1]);var p=t(n,r,o,i);return p}function t(e,a,r,t){var i=leaflet_vars.markerUrl,o=(L.icon({iconUrl:i,iconSize:[14,14],shadowSize:[0,0],iconAnchor:[7,7],shadowAnchor:[4,62],popupAnchor:[0,0]}),L.featureGroup({snakingPause:500}));if(a.length>0&&r.length>0){for(s=0;s<r.length;s++){var n=L.marker(a[s],{icon:new L.DivIcon({className:"map__marker",html:'<img class="map__marker__image" src="'+i+'">'})}),l=L.polyline(r[s],{color:leaflet_vars.yellowTandem,className:"map__line",weight:6,opacity:.9,dashArray:"12, 10",lineJoin:"round",snakingSpeed:200});o.addLayer(n).addLayer(l)}if(1==r.length){var c=L.marker(a[s],{icon:new L.DivIcon({className:"map__marker",html:'<img class="map__marker__image" src="'+i+'">'})});c.bindPopup(t[s]),o.addLayer(c)}o.bindPopup('<a href="'+e.link+'">'+e.name+"</a>")}return o}function i(){var e="https://api.mapbox.com/styles/v1/retrorism/cio2pv2ft001ybvm8qb4da6f9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoicmV0cm9yaXNtIiwiYSI6IlhRWTE0d2cifQ.-Wi_jReZU4Wz_owPnVZDwQ",r=L.tileLayer(e,{subdomains:"1234"});if(void 0==map){map=L.map("leaflet-archive-map",{layers:[r],maxZoom:20,minZoom:0,zoomControl:1,scrollWheelZoom:0,attributionControl:!1}).setView([48,16],4);var t=L.control.attribution({prefix:!1}).addTo(map);t.addAttribution('Tiles Courtesy of <a href="http://www.mapbox.com/" target="_blank">MapBox</a> Â© <a href="http://www.openstreetmap.org/">OpenStreetMap</a> contributors')}a()}function o(){console.log("grid loaded")}for(var n=document.querySelectorAll(".focus"),s=0;s<n.length;s++){var l=n[s];img=l.getElementsByClassName("image--main")[0],img.classList.contains("lazy")||doFocusTranslate(img)}for(var c=document.querySelectorAll(".floated"),u=0;u<c.length;u++){var h=c[u].nextElementSibling,p=c[u].offsetHeight,d=h.offsetHeight;p>d&&(h.style.height=p+"px")}if(jQuery(".translatedparagraph--has_translations").each(function(){var e=jQuery(this).find(".translation-select");e.on("change",function(){function e(e){return function(a,r){jQuery(this).removeClass("show"),jQuery(this).hasClass(e)&&jQuery(this).addClass("show")}}var a="paragraph--"+this.value,r=jQuery(this).parent().parent(".translatedparagraph--has_translations");paragraphs=r.children(".translatedparagraph__paragraph"),paragraphs.each(e(a))})}),jQuery(".image--main").each(function(){console.log(jQuery(this).height())}),jQuery(".accordion p:empty, .orbit p:empty").remove(),jQuery(".archive__grid .columns","relatedgrid .columns").last().addClass("end"),jQuery('iframe[src*="youtube.com"], iframe[src*="vimeo.com"]').each(function(){jQuery(this).innerWidth()/jQuery(this).innerHeight()>1.5?jQuery(this).wrap("<div class='widescreen flex-video'/>"):jQuery(this).wrap("<div class='flex-video'/>")}),jQuery("body").hasClass("archive")){var m=jQuery(".archive__grid").masonry({itemSelector:".archive__grid__griditem"});jQuery(".archive__filter__button").each(function(){jQuery(this).on("click",function(){var e=jQuery(this).data("tax"),r=jQuery(this).parent().find(".archive__filter__datalist"),t=r.val();if(null!==t&&void 0!==t&&""!==t){var i=jQuery(".archive__filter").find(".archive__filter__tax-datalist[data-tax="+e+"]").find('option[value="'+t+'"]:not(:selected)');if(i.length){var o=i.data();o.name=t,o.tax=e;var n=getQueryTag(o,i),s=jQuery(".archive__filter__query-tags ul");s.empty().append(n),i.attr("selected","selected"),a()}r.val("")}})}),jQuery(".archive__button").on("click",function(e){e.preventDefault();var a=jQuery(this),r=a.data("paged"),t=a.data("max_num_pages"),i=a.data("object"),o=a.data("posts_per_page"),n=a.data("tax_query");n?(restBase="/wp-json/exchange/v1/"+i+"/"+n,filters="?page="+(r+2)+"&posts_per_page="+o):(restBase="/wp-json/wp/v2/"+i,filters="?filter[post_status]=publish&filter[posts_per_page]="+o+"&page="+(r+2)+"&filter[orderby]=date&filter[order]=desc");var s=baseUrl+restBase+filters;r+1<t&&jQuery.ajax({url:s,method:"GET",crossDomain:!0,contentType:"application/json",success:function(e,i,o){console.log(s);for(var n=e.length,l="",c=0;c<n;c++)l+=e[c].exchange_basics.griditem;var u=jQuery(l);m.append(u).masonry("appended",u).masonry(),r+=1,a.data("paged",r),r+1==t&&a.hide()},error:function(e){console.log(e)}})})}jQuery("body").hasClass("post-type-archive-collaboration")&&(jQuery(".archive__view__toggle").find("a").each(function(){jQuery(this).on("click",function(e){var a=jQuery(this),r=a.data("exchange-toggle");e.preventDefault(),a.hasClass("active")||(a.addClass("active"),"archive__view--map"==r&&(jQuery(".grid-toggle").removeClass("active"),jQuery("#archive__view--map").removeClass("hide").animate({height:"500px"},500,i()),jQuery("#archive__view--grid").addClass("hide")),"archive__view--grid"==r&&(jQuery(".map-toggle").removeClass("active"),jQuery("#archive__view--grid").removeClass("hide"),o(),jQuery("#archive__view--map").animate({height:"0"},500,function(){jQuery(this).addClass("hide")})))})}),jQuery("#archive__view--map").hasClass("hide")||i())});
//# sourceMappingURL=scripts.min.js.map
