function handleScroll(){var e=pageYOffset;jQuery(window).scroll(function(){var a=jQuery(this).scrollTop();e=a,pageYOffset<100?jQuery(".breadcrumbs-bar").removeClass("scrolled"):jQuery(".breadcrumbs-bar").addClass("scrolled")})}function getArchiveMap(){if(void 0!==Exchange&&void 0!==Exchange.PluginExtensions&&void 0!==Exchange.PluginExtensions.LMP&&void 0!==Exchange.PluginExtensions.LMP.maps){for(var e in Exchange.PluginExtensions.LMP.maps)if(Exchange.PluginExtensions.LMP.maps.hasOwnProperty(e)){archiveMap=Exchange.PluginExtensions.LMP.maps[e],archiveMap.hash=e.slice(4);break}return archiveMap?archiveMap:void 0}}function getUrlVars(){for(var e,a=[],t=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),s=0;s<t.length;s++)e=t[s].split("="),a.push(e[0]),a[e[0]]=e[1];return a}function getFocusTranslate(e,a){if(img_data=e.parentNode.dataset,!img_data)return!1;var t=a.clientHeight,s=e.offsetHeight,r=img_data.focus_h*t-s/2,o=(t-s)/t*100,n=r/t*100;return!(r<0||n<0)&&(n>o?o:n)}function doFocusTranslate(e){var a=e.parentNode,t=getFocusTranslate(a,e);if(t){var s=t>0?-1*t:t,r="transform: translateY("+s+"%);";e.setAttribute("style",r)}}function processFloatedElements(){var e=document.querySelectorAll(".floated");if(!(!e.length>0))for(var a=0;a<e.length;a++){var t=e[a].nextElementSibling,s=e[a].offsetHeight,r=t.offsetHeight;s>r&&(t.style.height=s+"px")}}function addFacetMarker(e){var a=jQuery(".accordion").find("li[data-facet-type="+e+"]");a.hasClass("is-active")||a.find("span.filter-count").html(" &#x2714")}function removeFacetMarker(e){var a=jQuery(".accordion").find("li[data-facet-type="+e+"]");a.find("span.filter-count").html("")}function processFacetsUI(){var e="",a="",t={count:0,facets:[]},s=[location.protocol,"//",location.host,location.pathname].join(""),r=" results";if(void 0!==FWP.facets||void 0!==FWP.settings.selected_facets){if(void 0!==FWP.facets){FWP.facets.search.length>0&&(t.facets.push({name:"search",terms:['"'+FWP.facets.search+'"']}),jQuery(".facetwp-search").val(FWP.facets.search),t.count++,a+='<ul class="term-list" data-facet-type="search">',a+='<li class="term tag search">"'+FWP.facets.search+'" <a href="#" title="Remove this search query" class="remove-facet-value">&#10005;</a></li>',a+="</ul>");for(var o in FWP.facets)0===FWP.facets[o].length&&removeFacetMarker(o)}if(void 0!==FWP.settings.selected_facets){for(var n in FWP.settings.selected_facets){var i=FWP.settings.selected_facets[n];if(i.length>0){addFacetMarker(n),t.facets.push({name:n,terms:i}),facetLabel=void 0!==FWP.settings.labels[n]?FWP.settings.labels[n]:"",t.count<6&&(a+='<ul class="term-list" data-facet-type="'+n+'">');for(var c=0;i.length>c&&i.length<6;c++)if(FWP.facets[n].indexOf(i[c].slug)>-1&&(t.count++,t.count<6)){var l=s+"?fwp_"+n+"="+encodeURIComponent(i[c].slug);vacetUrl="#",a+='<li class="tag '+n+'" data-facet-value="'+i[c].slug+'">'+i[c].name+' <a href="'+l+'" class="remove-facet-value" title="Remove this '+facetLabel.toLowerCase()+": "+i[c].name+'">&#10005;</a></li>'}t.count<6&&(a+="</ul>")}}t.count>5&&(a+=6===t.count?'<span class="other-terms"> and 1 other tag</span>':'<span class="other-terms">and '+(t.count-5)+" other tags.</span>")}FWP.loaded||(e="<h5>Loading...</h5>"),void 0!==FWP.settings.pager&&FWP.settings.pager.total_rows>=0&&(0===FWP.settings.pager.total_rows?e="<h5>No"+r+" found</h5>":(r=1===FWP.settings.pager.total_rows?" result":" results",jQuery("body").hasClass("post-type-archive-story")&&(r=1===FWP.settings.pager.total_rows?" story":" stories"),jQuery("body").hasClass("post-type-archive-collaboration")&&(r=1===FWP.settings.pager.total_rows?" collaboration":" collaborations"),e="<h5>Showing "+FWP.settings.pager.total_rows+r+"</h5>"),0===t.count&&(e+='<small class="no-terms">This is everything! You can use filters <span class="hide-for-small-only">to the left </span>to refine the results.</small>')),t.count>0?(jQuery("#main").addClass("facets-active"),jQuery(".archive__active-facet-summary").html(e.replace("</h5>"," for:</h5>")+a)):jQuery(".archive__active-facet-summary").html(e)}}var archiveMap,$grid,masonryOptions={percentPosition:!0,columnWidth:".masonry__grid-sizer",gutter:".masonry__gutter-sizer",itemSelector:".archive__grid__griditem"},masonryIsActive=!1;jQuery(document).foundation(),function(e){e(document).ready(function(){processFloatedElements();var a=e("body");void 0===$grid&&($grid=e(".archive__grid__masonry")),"object"==typeof FWP&&wp.hooks.addFilter("facetwp/template_html",function(a,t){return FWP.is_load_more?(FWP.is_load_more=!1,e(".facetwp-template").append(t.html),!0):a}),e(".focus").each(function(){var a=e(this).find(".image--main");a.on("load",function(e){doFocusTranslate(e.target)})}),e("a[data-open=story__modal--gallery]").on("click",function(a){a.preventDefault();var t=e(this).data("img_id"),s=e("#story__modal--gallery").find("#"+t);e(".orbit").foundation("changeSlide",!0,s)}),e("#token-form__submit").on("click",function(a){a.preventDefault(),e(this).prop("disabled",!0);var t=e(".token-form__collab-select option:selected"),s=e(".grid--form-options"),r=getUrlVars().pr;if(void 0!==t){var o={action:"exchange_token_form",update_id:t.val(),prid:t.data("programme-round"),token:r,security:e(".token-form__nonce").val()};e(".loader-pointer").remove(),e(".loader-wrapper").addClass("go"),s.html(""),e.ajax({url:exchange_ajax.ajax_url,method:"POST",data:o}).done(function(a){s.html(a),e(".loader-wrapper").removeClass("go"),e(this).removeProp("disabled")})}}),e(".translatedparagraph--has_translations").each(function(){var a=e(this).find(".translation-select");a.on("change",function(){function a(a){return function(t,s){e(this).removeClass("show"),e(this).hasClass(a)&&e(this).addClass("show")}}var t="paragraph--"+this.value,s=e(this).parent().parent(".translatedparagraph--has_translations");paragraphs=s.children(".translatedparagraph__paragraph"),paragraphs.each(a(t))})}),(a.hasClass("single")||a.hasClass("page-child"))&&e("#main").on("scrollme.zf.trigger",handleScroll),(a.hasClass("archive")||a.hasClass("page-template-archive")||a.hasClass("search")||1===e(".featuredgrid__masonry").length)&&(a.hasClass("post-type-archive-participant")&&(void 0===archiveMap&&(archiveMap=getArchiveMap()),archiveMap&&archiveMap.map.fitBounds(archiveMap.clusterLayer.getBounds())),void 0!==$grid&&($grid.masonry(masonryOptions),masonryIsActive=!0)),e("#facet-tabs").on("change.zf.tabs",function(){void 0===archiveMap&&(archiveMap=getArchiveMap()),void 0!==archiveMap.map&&archiveMap.map.invalidateSize().fitBounds(archiveMap.clusterLayer.getBounds()),void 0!==$grid&&($grid.masonry(masonryOptions),masonryIsActive=!0)}),e("#facet-switch").on("click",function(){"#main".foundation("toggle")}),e(".accordion p:empty, .orbit p:empty").remove(),e(".archive__grid .columns","relatedgrid .columns").last().addClass("end"),e('iframe[src*="youtube.com"], iframe[src*="vimeo.com"]').each(function(){e(this).innerWidth()/e(this).innerHeight()>1.5?e(this).wrap("<div class='widescreen flex-video'/>"):e(this).wrap("<div class='flex-video'/>")})}),e(document).on("click",".fwp-load-more",function(){e(".fwp-load-more").html("Loading..."),FWP.is_load_more=!0,FWP.paged=parseInt(FWP.settings.pager.page)+1,FWP.soft_refresh=!0,FWP.refresh()}),e(document).on("click",".facetwp-facet-search .facetwp-btn--exchange",function(a){a.preventDefault();var t=e(".facetwp-search").val().trim(),s=e.Event("keydown");s.which=50,s.keyCode=50,FWP.facets.search=t,FWP.refresh()}),e(document).on("click",".remove-facet-value",function(a){a.preventDefault();var t=e(this).parent();if(facetType=t.parent().data("facet-type"),facetValue=t.data("facet-value"),"search"===facetType)jQuery(".facetwp-search").val(""),jQuery('ul[data-facet-type="search"]').first().remove();else{var s=FWP.facets[facetType].indexOf(facetValue);s>-1&&(FWP.facets[facetType].splice(s,1),e('div[data-value="'+facetValue+'"]').first().removeClass("checked"))}FWP.refresh()})}(jQuery),function(e){e(document).on("facetwp-loaded",function(){if(processFacetsUI(),e(".no-terms").show(),$grid=e(".archive__grid__masonry"),masonryIsActive&&$grid.masonry("destroy"),$grid.masonry(masonryOptions),masonryIsActive=!0,FWP.settings.pager.page<FWP.settings.pager.total_pages?(e(".fwp-load-more").html("Load more"),e(".fwp-load-more").show()):e(".fwp-load-more").hide(),FWP.settings.pager.page>1&&e("html, body").animate({scrollTop:e(".archive__grid__masonry").offset().bottom},1e3),archiveMap=getArchiveMap(),void 0!==archiveMap){var a=window["leaflet_objects_"+archiveMap.hash];if(void 0!==a&&0!==a.map_polylines.length&&0!==FWP.settings.matches.length&&a.map_polylines.length>0&&FWP.settings.matches.length>0){var t=a.map_polylines.filter(function(e){if(FWP.settings.matches.includes(e.id))return!0});if(t.length>0){var s={map_polylines:t};archiveMap.renderObjects(s)}}}})}(jQuery),function(e){e(document).on("facetwp-refresh",function(){jQuery(".archive__active-facet-summary").html("<h5>Loading...</h5>"),FWP.loaded||(FWP.paged=1)})}(jQuery);
//# sourceMappingURL=scripts.min.js.map
