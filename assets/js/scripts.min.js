function isEmpty(e){if(null==e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;if("object"!=typeof e)return!0;for(var a in e)if(hasOwnProperty.call(e,a))return!1;return!0}function createRoute(e,a,r){var t=leaflet_vars.markerUrl,o=(L.icon({iconUrl:t,iconSize:[14,14],shadowSize:[0,0],iconAnchor:[7,7],shadowAnchor:[4,62],popupAnchor:[0,0]}),L.featureGroup({snakingPause:500}));if(e.length>0&&a.length>0){for(i=0;i<a.length;i++){var n=L.marker(e[i],{icon:new L.DivIcon({className:"map__marker",html:'<img class="map__marker__image" src="'+t+'"><span class="map__marker__label">'+r[i]+"</span>"})}),s=L.polyline(a[i],{color:leaflet_vars.yellowTandem,className:"map__line",weight:6,opacity:.9,dashArray:"12, 10",lineJoin:"round",snakingSpeed:200});o.addLayer(n).addLayer(s)}if(1==a.length){var l=L.marker(e[i],{icon:new L.DivIcon({className:"map__marker",html:'<img class="map__marker__image" src="'+t+'"><span class="map__marker__label">'+r[i]+"</span>"})});l.bindPopup(r[i]),o.addLayer(l)}}return o}function fetchCollaborationsQuery(){var e=jQuery(".archive__filter__query-tags").find("a.tag"),a={object:"collaborations",taxquery:{}};if(e.length)for(var r=0;r<e.length;r++){var t=jQuery(e[r]),o=t.data("tax"),i=t.data("slug");("string"==typeof o||o instanceof String)&&("string"==typeof i||i instanceof String)&&(a.taxquery[o]=i)}else if(1==mapInitial){var n=getRandomProgrammeRound();a.taxquery={tag:n},mapInitial=0}var s="",l=a.taxquery;if(isEmpty(l))return null;for(var c in a.taxquery)l.hasOwnProperty(c)&&(s+="&filter["+c+"]="+l[c]);var u="?filter[post_status]=publish"+s+"&filter[orderby]=date&filter[order]=desc",p="/wp-json/wp/v2/"+a.object,h=baseUrl+p+u;return h}function prepareCollaborationMarkers(e){console.log(e);var a=[],r=[],t=[],o=[],i={name:e.title,link:e.link};if(isEmpty(e.locations))return null;for(var n in e.locations)if(e.locations.hasOwnProperty(n)){var s=e.locations[n],l=[];jQuery.isNumeric(s.org_lat)&&l.push(s.org_lat),jQuery.isNumeric(s.org_lng)&&l.push(s.org_lng),2==l.length&&a.push(l),""!=s.org_city&&t.push(s.org_city)}for(var c=a.length,u=0;u<c;u++)r.push(a[u]),u===c-1?c>2&&o.push([a[u],a[0]]):o.push([a[u],a[u+1]]);2==c&&r.push(a[1]);var p=createArchiveRoute(i,r,o,t);return p}function createArchiveRoute(e,a,r,t){var o=leaflet_vars.markerUrl,n=(L.icon({iconUrl:o,iconSize:[14,14],shadowSize:[0,0],iconAnchor:[7,7],shadowAnchor:[4,62],popupAnchor:[0,0]}),L.featureGroup({snakingPause:500}));if(a.length>0&&r.length>0){for(i=0;i<r.length;i++){var s=L.marker(a[i],{icon:new L.DivIcon({className:"map__marker",html:'<img class="map__marker__image" src="'+o+'">'})}),l=L.polyline(r[i],{color:leaflet_vars.yellowTandem,className:"map__line",weight:6,opacity:.9,dashArray:"12, 10",lineJoin:"round",snakingSpeed:200});n.addLayer(s).addLayer(l)}if(1==r.length){var c=L.marker(a[i],{icon:new L.DivIcon({className:"map__marker",html:'<img class="map__marker__image" src="'+o+'">'})});c.bindPopup(t[i]),n.addLayer(c)}n.bindPopup('<a href="'+e.link+'">'+e.name+"</a>")}return n}function loadMap(){var e="https://api.mapbox.com/styles/v1/retrorism/cio2pv2ft001ybvm8qb4da6f9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoicmV0cm9yaXNtIiwiYSI6IlhRWTE0d2cifQ.-Wi_jReZU4Wz_owPnVZDwQ",a=L.tileLayer(e,{subdomains:"1234"});if(void 0==map){map=L.map("leaflet-archive-map",{layers:[a],maxZoom:20,minZoom:0,zoomControl:1,scrollWheelZoom:0,attributionControl:!1}).setView([48,16],4);var r=L.control.attribution({prefix:!1}).addTo(map);r.addAttribution('Tiles Courtesy of <a href="http://www.mapbox.com/" target="_blank">MapBox</a> Â© <a href="http://www.openstreetmap.org/">OpenStreetMap</a> contributors')}fetchCollaborations()}function loadGrid(){console.log("grid loaded")}function fetchCollaborations(){var e=fetchCollaborationsQuery();null===e?(console.log("emptying map"),map.removeLayer(routeLayer)):(console.log("called with "+e),jQuery.when(jQuery.ajax({url:e,method:"GET",crossDomain:!0,contentType:"application/json"})).then(function(e,a,r){var t=e.length,o=[];if(t>0){for(var i=0;i<t;i++)o.push(e[i].exchange_basics.data);collectionLength=o.length,routes=[];for(var n=0;n<collectionLength;n++){var s=prepareCollaborationMarkers(o[n]);null!==s&&routes.push(s)}console.log(routes),void 0!==routeLayer&&map.removeLayer(routeLayer),routes.length>0&&(routeLayer=L.featureGroup(routes).addTo(map),map.fitBounds(routeLayer.getBounds().pad(.033)))}}))}function getQueryTag(e,a){console.log(e.tax);var r=document.createElement("a"),t=document.createElement("li"),o=document.createTextNode(e.name);return r.setAttribute("data-term_id",e.id),r.setAttribute("data-slug",e.slug),r.setAttribute("data-tax",e.tax),r.setAttribute("title",e.name),r.setAttribute("href","#"),r.addEventListener("click",function(e){e.preventDefault(),a.removeAttr("selected"),this.parentNode.remove(),fetchCollaborations()}),r.className="tag query-tag "+e.tax,r.appendChild(o),t.appendChild(r),t}function getRandomProgrammeRound(){var e=jQuery(".archive__filter").find(".archive__filter__tax-datalist[data-tax=tag]").find("option");if(e.length){var a=e.length,r=Math.floor(Math.random()*a);return console.log(r),prog=jQuery(e[r]),prog.data("slug")}}jQuery(document).foundation();var hasOwnProperty=Object.prototype.hasOwnProperty,baseUrl=location.origin,mapInitial=1,map,routeLayer;location.origin||(baseUrl=location.protocol+"//"+location.host),"http://localhost"==location.origin&&(baseUrl=location.origin+"/tandem");var getFocusTranslate=function(e,a){if(img_data=e.parentNode.dataset,!img_data)return!1;var r=a.offsetHeight,t=e.offsetHeight,o=img_data.focus_h*r-t/2,i=(r-t)/r*100,n=o/r*100;return!(o<0||n<0)&&(n>i?i:n)},doFocusTranslate=function(e){var a=e.parentNode;if(translate=getFocusTranslate(a,e),translate){var r=translate>0?-1*translate:translate,t="transform: translateY("+r+"%);";e.setAttribute("style",t)}};jQuery(document).foundation(),jQuery(document).ready(function(){for(var e=document.querySelectorAll(".focus"),a=0;a<e.length;a++){var r=e[a];img=r.getElementsByClassName("image--main")[0],img.classList.contains("lazy")||doFocusTranslate(img)}for(var t=document.querySelectorAll(".floated"),o=0;o<t.length;o++){var i=t[o].nextElementSibling,n=t[o].offsetHeight,s=i.offsetHeight;n>s&&(i.style.height=n+"px")}if(jQuery(".translatedparagraph--has_translations").each(function(){var e=jQuery(this).find(".translation-select");e.on("change",function(){function e(e){return function(a,r){jQuery(this).removeClass("show"),jQuery(this).hasClass(e)&&jQuery(this).addClass("show")}}var a="paragraph--"+this.value,r=jQuery(this).parent().parent(".translatedparagraph--has_translations");paragraphs=r.children(".translatedparagraph__paragraph"),paragraphs.each(e(a))})}),jQuery(".image--main").each(function(){console.log(jQuery(this).height())}),jQuery(".accordion p:empty, .orbit p:empty").remove(),jQuery(".archive__grid .columns","relatedgrid .columns").last().addClass("end"),jQuery('iframe[src*="youtube.com"], iframe[src*="vimeo.com"]').each(function(){jQuery(this).innerWidth()/jQuery(this).innerHeight()>1.5?jQuery(this).wrap("<div class='widescreen flex-video'/>"):jQuery(this).wrap("<div class='flex-video'/>")}),jQuery("body").hasClass("archive")){var l=jQuery(".masonry").masonry({itemSelector:".archive__grid__griditem"});jQuery(".archive__filter__button").each(function(){jQuery(this).on("click",function(){var e=jQuery(this).data("tax"),a=jQuery(this).parent().find(".archive__filter__datalist"),r=a.val();if(null!==r&&void 0!==r&&""!==r){var t=jQuery(".archive__filter").find(".archive__filter__tax-datalist[data-tax="+e+"]").find('option[value="'+r+'"]:not(:selected)');if(t.length){var o=t.data();o.name=r,o.tax=e;var i=getQueryTag(o,t),n=jQuery(".archive__filter__query-tags ul");n.empty().append(i),t.attr("selected","selected"),fetchCollaborations()}a.val("")}})}),jQuery(".archive__button").on("click",function(e){e.preventDefault();var a=jQuery(this),r=a.data("paged"),t=a.data("max_num_pages"),o=a.data("object"),i=a.data("posts_per_page"),n=a.data("tax_query");n?(restBase="/wp-json/exchange/v1/"+o+"/"+n,filters="?page="+(r+2)+"&posts_per_page="+i):(restBase="/wp-json/wp/v2/"+o,filters="?filter[post_status]=publish&filter[posts_per_page]="+i+"&page="+(r+2)+"&filter[orderby]=date&filter[order]=desc");var s=baseUrl+restBase+filters;r+1<t&&jQuery.ajax({url:s,method:"GET",crossDomain:!0,contentType:"application/json",success:function(e,o,i){console.log(s);for(var n=e.length,c="",u=0;u<n;u++)c+=e[u].exchange_basics.griditem;var p=jQuery(c);l.append(p).masonry("appended",p).masonry(),r+=1,a.data("paged",r),r+1==t&&a.hide()},error:function(e){console.log(e)}})})}jQuery("body").hasClass("post-type-archive-collaboration")&&(jQuery(".archive__view__toggle").find("a").each(function(){jQuery(this).on("click",function(e){var a=jQuery(this),r=a.data("exchange-toggle");e.preventDefault(),a.hasClass("active")||(a.addClass("active"),"archive__view--map"==r&&(jQuery(".grid-toggle").removeClass("active"),jQuery("#archive__view--map").removeClass("hide").animate({height:"500px"},500,loadMap()),jQuery("#archive__view--grid").addClass("hide")),"archive__view--grid"==r&&(jQuery(".map-toggle").removeClass("active"),jQuery("#archive__view--grid").removeClass("hide"),loadGrid(),jQuery("#archive__view--map").animate({height:"0"},500,function(){jQuery(this).addClass("hide")})))})}),jQuery("#archive__view--map").hasClass("hide")||loadMap())});
//# sourceMappingURL=scripts.min.js.map
